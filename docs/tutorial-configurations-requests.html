<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Devo Applications Builder Requests</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Devo Applications Builder</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-basics.html">
                                Getting started
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-configurations.html">
                                Advanced
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-widgets.html">
                                Widgets
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/DevoInc/applications-builder"
                        >
                            Github
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://github.com/DevoInc/applications-builder-template"
                        >
                            Example Application
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar tutorials"
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-basics.html">Getting started</a><ul><li><a href="tutorial-basic-requirements.html">Requirements</a></li><li><a href="tutorial-basic-installing.html">Installation</a></li><li><a href="tutorial-basic-overview.html">Overview</a></li><li><a href="tutorial-basic-first-app.html">First application</a></li><li><a href="tutorial-basic-add-tabs.html"> - Adding tabs</a></li><li><a href="tutorial-basic-add-sections.html"> - Adding sections</a></li><li><a href="tutorial-basic-add-widgets.html"> - Adding widgets</a></li><li><a href="tutorial-basic-directory-structure.html">Directory structure</a></li></ul></li><li><a href="tutorial-configurations.html">Advanced</a><ul><li><a href="tutorial-configurations-init.html">Initial configuration</a></li><li><a href="tutorial-configurations-requests.html">Requests</a></li><li><a href="tutorial-configurations-translations.html">Translations</a></li><li><a href="tutorial-configurations-template.html">Template</a></li><li><a href="tutorial-configurations-actions.html">Widget actions</a></li><li><a href="tutorial-configurations-fields.html">Fields</a></li><li><a href="tutorial-configurations-fields-input.html"> - Input text</a></li><li><a href="tutorial-configurations-fields-button.html"> - Button</a></li><li><a href="tutorial-configurations-fields-checkbox.html"> - Checkbox</a></li><li><a href="tutorial-configurations-fields-select.html"> - Select</a></li><li><a href="tutorial-configurations-fields-choice-picker.html"> - Choice picker</a></li><li><a href="tutorial-configurations-fields-datetime.html"> - Datetime picker</a></li><li><a href="tutorial-configurations-fields-datetime-range.html"> - Datetime range picker</a></li><li><a href="tutorial-configurations-fields-datetime-presets.html"> - Datetime range picker presets</a></li><li><a href="tutorial-configurations-icons.html">Icons</a></li><li><a href="tutorial-configurations-devo-apis.html">Devo APIs</a></li></ul></li><li><a href="tutorial-widgets.html">Widgets</a><ul><li><a href="tutorial-widgets-animated-heatmap.html">Animated Heatmap</a></li><li><a href="tutorial-widgets-area.html">Area</a></li><li><a href="tutorial-widgets-availability-timeline.html">Availability Timeline</a></li><li><a href="tutorial-widgets-bichord.html">Bichord</a></li><li><a href="tutorial-widgets-bubbles.html">Bubbles</a></li><li><a href="tutorial-widgets-bullet.html">Bullet</a></li><li><a href="tutorial-widgets-circle-world-map.html">Circle World Map</a></li><li><a href="tutorial-widgets-column.html">Column</a></li><li><a href="tutorial-widgets-empty.html">Empty</a></li><li><a href="tutorial-widgets-funnel.html">Funnel</a></li><li><a href="tutorial-widgets-gauge.html">Gauge</a></li><li><a href="tutorial-widgets-google-colormap.html">Google Colormap</a></li><li><a href="tutorial-widgets-google-heatmap.html">Google Heatmap</a></li><li><a href="tutorial-widgets-graph.html">Graph</a></li><li><a href="tutorial-widgets-heat-calendar.html">Heat Calendar</a></li><li><a href="tutorial-widgets-histogram.html">Histogram</a></li><li><a href="tutorial-widgets-lines.html">Lines</a></li><li><a href="tutorial-widgets-monitoring.html">Monitoring</a></li><li><a href="tutorial-widgets-pew-pew-map.html">Pew Pew Map</a></li><li><a href="tutorial-widgets-pie.html">Pie</a></li><li><a href="tutorial-widgets-pie-layered.html">Pie Layered</a></li><li><a href="tutorial-widgets-punchcard.html">Punchcard</a></li><li><a href="tutorial-widgets-rag.html">RAG</a></li><li><a href="tutorial-widgets-sankey.html">Sankey</a></li><li><a href="tutorial-widgets-stacked-bars.html">Stacked Bars</a></li><li><a href="tutorial-widgets-table.html">Table</a></li><li><a href="tutorial-widgets-time-head-map.html">Time Heatmap</a></li><li><a href="tutorial-widgets-tree.html">Tree</a></li><li><a href="tutorial-widgets-voronoi.html">Voronoi</a></li></ul></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Tutorial</p>
                    <h1>Requests</h1>
                </header>
                <section>

<article>
    <p>The <em>Devo Applications Builder</em> allows queries to any source.
However, generally the queries are made directly to data stored our platform.
These queries are made through the Devo
<a href="https://docs.devo.com/confluence/ndt/latest/api-reference/query-api/running-queries-with-the-query-api">Query API</a>.</p>
<p>In applications, the queries are defined in the <code>src/resources/requests.js</code>
file.</p>
<h2>Devo Query API requests</h2>
<p>The queries using the API are expresseds in LINQ.
If you need to know more information about
<a href="https://docs.devo.com/confluence/ndt/latest/searching-data/building-a-query/build-a-query-using-linq">how build a query using LINQ language</a>,
go to our public documentation.
The authentication of the applications with the Query API is delegated to
<em>Devo Applications Data Library</em>, you will not have to worry about it.</p>
<p>A simple query will look like the following:</p>
<pre class="prettyprint source"><code>from demo.ecommerce.data select *
</code></pre>
<h3>The Request class</h3>
<p>The <a href="https://github.com/DevoInc/applications-data-library/blob/master/doc/request/Request.md">Request</a> class is the main one to create a request in
<em>Devo Applications Builder</em>.
However, in applications it is common to use other classes, which inherit from
this one, to make requests.</p>
<h3>Simple query request</h3>
<p>To create a simple request, we must create an instance of class <em>RequestApi</em>.
Visit the <a href="https://github.com/DevoInc/applications-data-library">Devo Applications Data Library</a> documentation for more
information.</p>
<pre class="prettyprint source lang-javascript"><code>import RequestApi from '@devoinc/applications-data-library/requests/RequestApi';
import dateRange from '@devoinc/applications-builder/utils/dateRange';
..

let request = new RequestApi({
  query: 'from demo.ecommerce.data select *',
  dates: dateRange.fromNow(1, 'day'),
});
</code></pre>
<p>Method <a href="module-dateRange.html"><em>dateRange</em></a> is a <em>Devo Applications Builder</em>
utility for managing dates.</p>
<p>However, you can use custom dates for a query.
You just have to declare an object with the <em>from</em> and the <em>to</em> timestamp
values of the date period you want to make the request.</p>
<pre class="prettyprint source lang-javascript"><code>import RequestApi from '@devoinc/applications-data-library/requests/RequestApi';
import dateRange from '@devoinc/applications-builder/utils/dateRange';
..

let request = new RequestApi({
  query: 'from demo.ecommerce.data select *',
  dates: {
    from: moment('01/01/2020').valueOf(),
    to: moment('02/01/2020').valueOf()
    },
});
</code></pre>
<h3>Simulate query request</h3>
<p>Sometimes you can simulate a request for testing purposes and simultae a
normal request.
Instead of request to the API, you need to load a JSON object locally.</p>
<p>To simulate a request, use the <a href="https://github.com/DevoInc/applications-data-library/blob/master/doc/request/RequestApiMock.md">RequestApiMock</a> class.</p>
<pre class="prettyprint source lang-javascript"><code>import RequestApiMock from '@devoinc/applications-data-library/requests/RequestApiMock';

let data = {
  m: {
    eventdate: { type: 'timestamp', index: 0 },
    count: { type: 'int8', index: 1 },
  },
  d: [
    [1551916800000, 21520],
    [1552003200000, 551753],
    [1552089600000, 552003],
    [1552176000000, 551988],
    [1552262400000, 551497],
    [1552348800000, 551307],
    [1552435200000, 551290],
    [1552521600000, 551193],
    [1552608000000, 551580],
  ],
};

let request = new RequestApiMock({
  results: data,
  delay: 1000,
});
</code></pre>
<h3>Queries request in sequence</h3>
<p>Sometimes you will need a widget to display the data resulting from a series
of requests and operations.
The <a href="https://github.com/DevoInc/applications-data-library/blob/master/doc/request/RequestChain.md">RequestChain</a> class allows these types of requests to be made.</p>
<p>The <em>RequestChain</em> receives an array of a mix of functions and Request object
that will be executed sequenctially.</p>
<pre class="prettyprint source lang-javascript"><code>import RequestApi from '@devoinc/applications-data-library/requests/RequestApi';
import RequestChain from '@devoinc/applications-data-library/requests/RequestChain';
import dateRange from '@devoinc/applications-builder/utils/dateRange';
..

let request = new RequestChain([
  new RequestApi({
    template: `from demo.ecommerce.data
               group by method
               select count() as count`,
    dates: dateRange.fromNow(1, 'day')
  }),
  (data) => {
    return {
      methods:
        JSON.stringify(Array.from(new Set(data.object.map(i => i.method))))
    };
  },
  new RequestApi({
    template: `from siem.logtrust.web.activity
               where method in {{methods}}
               group by hostname
               select count() as count`,
    dates: dateRange.fromNow(1, 'day')
  }),
]);
</code></pre>
<blockquote>
<p>Each query on Request object should be declarated as a <code>template</code>.</p>
</blockquote>
<h3>Request cache</h3>
<p>By default, the request has a mechanism for buffering the result data.
This prevents to call the request twice with the same parameters.</p>
<p>If the application does not need this functionallity (in case of too much
memory taken or if the result of the query changes even if the same params
are used) you can disable this behaviour:</p>
<pre class="prettyprint source lang-javascript"><code>requests.add(
  'requestKey',
  new RequestApi({
    query: 'from demo.ecommerce.data select *',
    dates: dateRange.fromNow(1, 'day'),
    cache: false,
  })
);
</code></pre>
<h3>Queries templates</h3>
<p>Sometimes a query needs to change over the time, but only in some fields.
For example, make a query that depends on a selector with the names of the
methods.</p>
<pre class="prettyprint source"><code>from demo.ecommerce.data where method=&quot;{{selectedMethod}}&quot;
</code></pre>
<p>In the query, <em>selectedMethod</em> is a value that can be changed by the user.
The request object should be like the following code:</p>
<pre class="prettyprint source lang-javascript"><code>let request = new RequestApi({
  template: 'from demo.ecommerce.data where method=&quot;{{selectedMethod}}',
  dates: dateRange.fromNow(1, 'day'),
});
</code></pre>
<blockquote>
<p>Pay attention to the change of <em>query</em> by <em>template</em>.</p>
</blockquote>
<p>Then, in the widget you will need indicate to use the template.</p>
<pre class="prettyprint source lang-javascript"><code>widget.setRequests(requests.get('requestID').parseTemplate({ selectedMethod: 'GET' });
</code></pre>
<h3>Requests singleton</h3>
<p>To reuse the requests between code of the application, <em>Devo Applications Data Library</em> use a <em>Singleton</em> pattern from <em>Devo Applications Builder</em>.</p>
<p>So, in the <code>src/resources/requests.js</code> file each request must be added to the <a href="Requests.html">Requests</a> class.</p>
<pre class="prettyprint source lang-javascript"><code>import requests from '@devoinc/applications-builder/data/requests';
import RequestApi from '@devoinc/applications-data-library/requests/RequestApi';
import dateRange from '@devoinc/applications-builder/utils/dateRange';

requests.add(
  'requestKey',
  new RequestApi({
    query: 'from siem.logtrust.web.activity select *',
    dates: dateRange.fromNow(1, 'day'),
  })
);
</code></pre>
<p>Then, you can use it in the widgets or in any other part of the application.</p>
<pre class="prettyprint source lang-javascript"><code>import requests from &quot;@devoinc/applications-builder/data/requests&quot;;

...

widget.setRequests([requests.get(&quot;requestKey&quot;)]);
</code></pre>
<h3>Launch the query in the Data Search</h3>
<p>The application queries can be launched in the Data Search.
This option is available in each widget, in the menu on the right side.</p>
<img src="application/data-search.png" alt="Go to query" />
<p>However, not all queries are supported.
So, in this case the owner of the application should adapt the request for this option.</p>
<p>See the documentation <a href="module-dataSearch.html">here</a>.</p>
<h2>Query to an external API</h2>
<p>You can query data from an external resource.
The <a href="https://github.com/DevoInc/applications-data-library/blob/master/doc/request/RequestApiCustom.md">RequestCustom</a> class wraps a custom call into the framework lifecycle.</p>
<p>In this case you will need to create a function that adapts the data to the data structure supported by <em>Devo Applications Data Library</em>.</p>
<pre class="prettyprint source lang-javascript"><code>import RequestApi from '@devoinc/applications-data-library/requests/RequestCustom';

function apiCall(cb) {
  $.ajax({
    url: 'https://somebigdataplatformnotascoolasdevo/api/resource',
    type: 'POST',
    data: {
      token: '1234567890SuperSecure',
    },
    success: cb,
  });
}

let request = new RequestCustom({
  callFn: apiCall,
});
</code></pre>
<p>By default, widgets expect data to come in the following format:</p>
<pre class="prettyprint source lang-json"><code>  {
    &quot;m&quot;: {
      &quot;field1&quot;: {&quot;type&quot;:&quot;timestamp&quot;,&quot;index&quot;:0},
      &quot;field2&quot;:{&quot;type&quot;:&quot;int8&quot;,&quot;index&quot;:1}
      ...
    },
    &quot;d&quot;:[
      [valueField1, valueField2],
      [valueField1, valueField2],
      [valueField1, valueField2],
      [valueField1, valueField2],
      ...
    ]
  }
</code></pre>
</article>

</section>

            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>